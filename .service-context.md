# ğŸ” AUTH SERVICE - CONTEXTO

## ğŸ“ PosiÃ§Ã£o na Arquitetura
MicrosserviÃ§o de autenticaÃ§Ã£o e autorizaÃ§Ã£o, gerencia usuÃ¡rios, login/registro e JWT tokens. Base para autenticaÃ§Ã£o de todos os outros serviÃ§os.

## ğŸŒ Endpoints Reais (Estado Atual)
- **Base URL**: https://api.wecando.click/auth
- **Porta Interna**: 8082 (definida no Kubernetes Service)
- **Namespace**: fiapx

## ğŸ”Œ APIs DisponÃ­veis
```http
GET  /auth/                    # Health check - "Auth Service - FiapX Video Processing"
GET  /auth/health             # Health check - "OK"
POST /auth/register           # Cadastro de usuÃ¡rio
POST /auth/login              # Login de usuÃ¡rio  
GET  /auth/me                 # Dados do usuÃ¡rio autenticado (requer JWT)
```

## ï¿½ Funcionalidades Implementadas
- **Cadastro de usuÃ¡rios**: Email, username (gerado automaticamente) e senha
- **Login com JWT**: Tokens com validade de 24h
- **ValidaÃ§Ã£o de usuÃ¡rio**: Middleware JWT para rotas protegidas
- **GeraÃ§Ã£o de username**: Baseado no nome + nÃºmero aleatÃ³rio
- **Hash de senhas**: bcrypt para seguranÃ§a
- **CORS habilitado**: Para acesso via frontend HTTPS

## ğŸš€ Deploy
```bash
## ğŸ—„ï¸ Banco de Dados
- **PostgreSQL**: ConexÃ£o via service interno do Kubernetes
- **Tabela**: `users` (id, username, email, password, created_at)
- **Host**: postgres:5432 (service interno)
- **Database**: fiapx_auth

## ğŸš€ Deploy (Estado Atual)
```bash
# 1. SSH para Worker Node
ssh -i ~/.ssh/keyPrincipal.pem ubuntu@worker.wecando.click

# 2. Docker Login
echo "Ch@plinh45" | docker login -u hmoraes --password-stdin

# 3. Build e Push da Imagem
scp -i ~/.ssh/keyPrincipal.pem -r auth-service/ ubuntu@worker.wecando.click:~/
ssh -i ~/.ssh/keyPrincipal.pem ubuntu@worker.wecando.click "cd ~/auth-service && docker build -t hmoraes/fiapx-auth-service:latest ."
ssh -i ~/.ssh/keyPrincipal.pem ubuntu@worker.wecando.click "docker push hmoraes/fiapx-auth-service:latest"

# 4. Deploy no Kubernetes
kubectl --kubeconfig=kubeconfig.yaml apply -f infrastructure/kubernetes/auth-service/
kubectl --kubeconfig=kubeconfig.yaml rollout restart deployment/auth-service -n fiapx
```

## ğŸ” Testes (Endpoints Reais)
```bash
# Health check
curl https://api.wecando.click/auth/health

# Registro
curl -X POST https://api.wecando.click/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"test","email":"test@test.com","password":"123456"}'

# Login
curl -X POST https://api.wecando.click/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@test.com","password":"123456"}'
```

## âš ï¸ ObservaÃ§Ãµes Importantes
- **Username Ã© gerado automaticamente** baseado no nome fornecido
- **Email Ã© Ãºnico** - nÃ£o permite duplicatas
- **JWT vÃ¡lido por 24h** - configurÃ¡vel via JWT_SECRET
- **Porta real**: 8082 (nÃ£o 8081 como estava documentado)
